#compdef claude-auto-runner.sh
# Zsh completion for claude-auto-runner.sh
# Install: Copy to a directory in $fpath (e.g., /usr/local/share/zsh/site-functions/)
# Or add to ~/.zshrc: fpath=(~/path/to/claude-auto-runner/completions $fpath)

_claude_auto_runner() {
    local -a options
    local -a log_sizes
    local -a wait_times
    
    # Define common values
    log_sizes=(
        '1048576:1MB'
        '5242880:5MB'
        '10485760:10MB (default)'
        '52428800:50MB'
        '104857600:100MB'
    )
    
    wait_times=(
        '1:1 second'
        '5:5 seconds (default)'
        '10:10 seconds'
        '30:30 seconds'
        '60:1 minute'
    )
    
    # Define options
    options=(
        '(- *)'{-h,--help}'[Show help message and exit]'
        '(- *)--version[Show version information and exit]'
        '(-d --dangerous)'{-d,--dangerous}'[Enable dangerous mode (--dangerously-skip-permissions)]'
        '(-v --verbose)'{-v,--verbose}'[Enable verbose output to see Claude'\''s thinking process]'
        '(-l --log-dir)'{-l,--log-dir}'[Set log file directory]:directory:_directories'
        '(-m1 --message1)'{-m1,--message1}'[Set first command message]:message:'
        '(-m2 --message2)'{-m2,--message2}'[Set second command message]:message:'
        '*'{-e,--error-pattern}'[Add error pattern to check]:pattern:'
        '(-c --clear-errors)'{-c,--clear-errors}'[Clear default error patterns before adding new ones]'
        '(-w --wait)'{-w,--wait}'[Set wait time between iterations]:seconds:->wait_times'
        '--max-log-size[Set maximum log file size in bytes]:size:->log_sizes'
        '--config[Use custom configuration file]:config file:_files -g "*.conf"'
    )
    
    # Handle state-specific completions
    case "$state" in
        wait_times)
            _describe -t wait-times 'wait time' wait_times
            ;;
        log_sizes)
            _describe -t log-sizes 'log size' log_sizes
            ;;
    esac
    
    # Complete the options
    _arguments -s -S $options
}

# Register the completion
compdef _claude_auto_runner claude-auto-runner.sh

# Also register for common invocation patterns
compdef _claude_auto_runner ./claude-auto-runner.sh
compdef _claude_auto_runner ~/*/claude-auto-runner.sh

# Register for installed version
if (( $+commands[claude-auto-runner.sh] )); then
    compdef _claude_auto_runner claude-auto-runner.sh
fi